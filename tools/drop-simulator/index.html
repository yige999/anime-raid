<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Raid Drop Rate Simulator | Drop Rate Calculator</title>
    <meta name="description" content="Anime Raid drop probability simulator, simulate boss drops, stage probabilities, equipment acquisition. Visualized drop rate statistics to help develop optimal farming strategies.">

    <!-- SEO Meta Tags -->
    <meta name="keywords" content="anime raid drop rate simulator, drop probability, boss drops, equipment acquisition">
    <meta name="author" content="Anime Raid Wiki">
    <link rel="canonical" href="https://animeraid.wiki/tools/drop-simulator/">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../../css/main.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../assets/icons/favicon.ico">
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="../../" class="flex items-center">
                        <img src="../../assets/images/logo.png" alt="Anime Raid Wiki" class="h-8 w-auto mr-3">
                        <span class="text-xl font-bold text-gray-900">Anime Raid Wiki</span>
                    </a>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="../../guides/" class="text-gray-700 hover:text-red-600 transition-colors">Strategy Guides</a>
                    <a href="../../codes/" class="text-gray-700 hover:text-red-600 transition-colors">Redemption Codes</a>
                    <a href="../../tier-lists/" class="text-gray-700 hover:text-red-600 transition-colors">Character Rankings</a>
                    <a href="../../database/units/" class="text-gray-700 hover:text-red-600 transition-colors">Database</a>
                    <a href="../" class="text-red-600 font-semibold">Tools</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="bg-gradient-to-r from-purple-600 to-pink-600 text-white py-16">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-6">Drop Rate Simulator</h1>
            <p class="text-xl mb-8">Drop Rate Simulator - Simulate boss drop probabilities and optimize your farming strategy</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="startSimulation()" class="bg-white text-purple-600 px-6 py-3 rounded-lg font-bold hover:bg-gray-100 transition-colors">
                    üé∞ Start Simulation
                </button>
                <button onclick="resetSimulation()" class="bg-yellow-400 text-gray-900 px-6 py-3 rounded-lg font-bold hover:bg-yellow-300 transition-colors">
                    üîÑ Reset Results
                </button>
            </div>
        </div>
    </section>

    <!-- Simulator Interface -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="grid lg:grid-cols-3 gap-8">

            <!-- Control Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg p-6 sticky top-24">
                    <h2 class="text-xl font-bold mb-6">‚öôÔ∏è Simulation Settings</h2>

                    <!-- Boss Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Select Boss</label>
                        <select id="boss-select" class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                            <option value="flame-dragon">Flame Dragon Lord</option>
                            <option value="ice-queen">Ice Queen</option>
                            <option value="shadow-lord">Shadow Lord</option>
                            <option value="thunder-giant">Thunder Giant</option>
                            <option value="ancient-tree">Ancient Tree Spirit</option>
                        </select>
                    </div>

                    <!-- Difficulty -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Difficulty Level</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setDifficulty('normal')" class="difficulty-btn active bg-green-100 text-green-700 p-2 rounded text-sm font-semibold">Normal</button>
                            <button onclick="setDifficulty('hard')" class="difficulty-btn bg-gray-100 text-gray-700 p-2 rounded text-sm font-semibold">Hard</button>
                            <button onclick="setDifficulty('extreme')" class="difficulty-btn bg-gray-100 text-gray-700 p-2 rounded text-sm font-semibold">Extreme</button>
                        </div>
                    </div>

                    <!-- Simulation Count -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Simulation Count: <span id="sim-count-value" class="text-purple-600">100</span>
                        </label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setSimCount(10)" class="bg-gray-100 hover:bg-purple-100 p-2 rounded text-sm font-semibold transition-colors">10</button>
                            <button onclick="setSimCount(100)" class="bg-purple-100 text-purple-700 p-2 rounded text-sm font-semibold">100</button>
                            <button onclick="setSimCount(1000)" class="bg-gray-100 hover:bg-purple-100 p-2 rounded text-sm font-semibold transition-colors">1000</button>
                        </div>
                        <input type="range" id="sim-count-slider" min="10" max="1000" value="100" step="10"
                               class="w-full mt-2 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <!-- Drop Rate Display -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-3">Expected Drop Rates</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Legendary Equipment</span>
                                <span class="text-sm font-bold text-purple-600">2.5%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Epic Equipment</span>
                                <span class="text-sm font-bold text-blue-600">8.0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Rare Equipment</span>
                                <span class="text-sm font-bold text-green-600">25.0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Common Equipment</span>
                                <span class="text-sm font-bold text-gray-600">64.5%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bonus Settings -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-3">Bonus Settings</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="vip-bonus" class="mr-2">
                                <span class="text-sm">VIP Drop Bonus (+10%)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="event-bonus" class="mr-2">
                                <span class="text-sm">Event Drop Bonus (+20%)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="lucky-tome" class="mr-2">
                                <span class="text-sm">Lucky Bonus (+15%)</span>
                            </label>
                        </div>
                    </div>

                    <button onclick="startSimulation()"
                            class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition-colors">
                        üé∞ Start Simulation
                    </button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="lg:col-span-2">
                <!-- Simulation Results -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-xl font-bold mb-6">üìä Simulation Results</h2>

                    <div id="simulation-results" class="hidden">
                        <!-- Summary Stats -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-600" id="total-drops">0</div>
                                <div class="text-sm text-gray-600">Total Drops</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-orange-600" id="legendary-count">0</div>
                                <div class="text-sm text-gray-600">Legendary Equipment</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600" id="epic-count">0</div>
                                <div class="text-sm text-gray-600">Epic Equipment</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" id="rare-count">0</div>
                                <div class="text-sm text-gray-600">Rare Equipment</div>
                            </div>
                        </div>

                        <!-- Drop History -->
                        <div class="mb-8">
                            <h3 class="font-semibold mb-4">üìú Drop History</h3>
                            <div id="drop-history" class="max-h-64 overflow-y-auto bg-gray-50 rounded-lg p-4">
                                <!-- Drop history items will be added here -->
                            </div>
                        </div>

                        <!-- Chart -->
                        <div class="mb-8">
                            <h3 class="font-semibold mb-4">üìà Drop Distribution Chart</h3>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <canvas id="drop-chart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Placeholder when no simulation -->
                    <div id="no-simulation" class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üé∞</div>
                        <p class="text-lg font-semibold">No simulation data yet</p>
                        <p class="text-sm mt-2">Click "Start Simulation" button to begin drop simulation</p>
                    </div>
                </div>

                <!-- Statistical Analysis -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-xl font-bold mb-6">üìà Statistical Analysis</h2>

                    <div id="statistical-analysis" class="hidden">
                        <!-- Actual vs Expected -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-4">Actual vs Expected Drop Rates</h3>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Legendary Equipment</span>
                                        <span>Actual: <span id="actual-legendary">0%</span> | Expected: 2.5%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-purple-500 h-2 rounded-full" id="legendary-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Epic Equipment</span>
                                        <span>Actual: <span id="actual-epic">0%</span> | Expected: 8.0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" id="epic-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Rare Equipment</span>
                                        <span>Actual: <span id="actual-rare">0%</span> | Expected: 25.0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" id="rare-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lucky Streaks -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-4">üçÄ Lucky Statistics</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-yellow-600" id="lucky-streak">0</div>
                                    <div class="text-sm text-gray-600">Longest Legendary Streak</div>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-red-600" id="unlucky-streak">0</div>
                                    <div class="text-sm text-gray-600">Longest No-Legendary Streak</div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Analysis -->
                        <div>
                            <h3 class="font-semibold mb-4">üí∞ Cost Analysis</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <div class="text-lg font-bold text-purple-600" id="cost-per-legendary">0</div>
                                    <div class="text-sm text-gray-600">Stamina Cost per Legendary</div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <div class="text-lg font-bold text-blue-600" id="total-cost">0</div>
                                    <div class="text-sm text-gray-600">Total Stamina Cost</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-bold mb-6">üí° Strategy Recommendations</h2>

                    <div id="recommendations" class="space-y-4 hidden">
                        <div class="border-l-4 border-green-500 pl-4">
                            <h3 class="font-semibold text-green-700">‚úÖ Optimal Strategy</h3>
                            <p class="text-sm text-gray-600">Based on current drop rate analysis, it's recommended to farm during events with lucky bonus to increase legendary drop rate to 3.4%.</p>
                        </div>
                        <div class="border-l-4 border-blue-500 pl-4">
                            <h3 class="font-semibold text-blue-700">üìä Efficiency Analysis</h3>
                            <p class="text-sm text-gray-600">Average <span id="avg-attempts">40</span> attempts needed to get a legendary equipment, recommended to prepare sufficient stamina.</p>
                        </div>
                        <div class="border-l-4 border-yellow-500 pl-4">
                            <h3 class="font-semibold text-yellow-700">‚ö†Ô∏è Risk Warning</h3>
                            <p class="text-sm text-gray-600">Due to randomness, actual drops may deviate from expected values, recommended to plan for the long term.</p>
                        </div>
                    </div>

                    <div id="no-recommendations" class="text-center py-8 text-gray-500">
                        <p>Strategy recommendations will be displayed after completing simulation</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p>&copy; 2025 Anime Raid Wiki. This site content is for learning and communication purposes only.</p>
                <p class="text-gray-400 mt-2">Drop rate simulator is based on probability calculations, actual game drops may vary according to official settings</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../../js/main.js"></script>
    <script>
        // Drop Rate Simulator JavaScript
        let simulationData = {
            boss: 'flame-dragon',
            difficulty: 'normal',
            count: 100,
            bonuses: {
                vip: false,
                event: false,
                lucky: false
            },
            results: {
                legendary: 0,
                epic: 0,
                rare: 0,
                common: 0,
                history: []
            }
        };

        let dropChart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSimulator();
        });

        function initializeSimulator() {
            // Simulation count slider
            const slider = document.getElementById('sim-count-slider');
            const valueDisplay = document.getElementById('sim-count-value');

            slider.addEventListener('input', function() {
                simulationData.count = parseInt(this.value);
                valueDisplay.textContent = this.value;
            });

            // Boss selection
            document.getElementById('boss-select').addEventListener('change', function() {
                simulationData.boss = this.value;
            });

            // Bonuses
            ['vip', 'event', 'lucky'].forEach(bonus => {
                document.getElementById(`${bonus}-bonus`).addEventListener('change', function() {
                    simulationData.bonuses[bonus] = this.checked;
                });
            });
        }

        function setDifficulty(level) {
            simulationData.difficulty = level;

            // Update button states
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700', 'bg-red-100', 'text-red-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });

            const activeBtn = Array.from(document.querySelectorAll('.difficulty-btn')).find(btn =>
                btn.textContent.toLowerCase().includes(level) ||
                (level === 'normal' && btn.textContent === 'Normal') ||
                (level === 'hard' && btn.textContent === 'Hard') ||
                (level === 'extreme' && btn.textContent === 'Extreme')
            );

            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-100', 'text-gray-700');
                if (level === 'normal') {
                    activeBtn.classList.add('active', 'bg-green-100', 'text-green-700');
                } else if (level === 'hard') {
                    activeBtn.classList.add('active', 'bg-yellow-100', 'text-yellow-700');
                } else {
                    activeBtn.classList.add('active', 'bg-red-100', 'text-red-700');
                }
            }
        }

        function setSimCount(count) {
            simulationData.count = count;
            document.getElementById('sim-count-slider').value = count;
            document.getElementById('sim-count-value').textContent = count;
        }

        function getDropRates() {
            const baseRates = {
                normal: { legendary: 0.025, epic: 0.08, rare: 0.25, common: 0.645 },
                hard: { legendary: 0.035, epic: 0.10, rare: 0.30, common: 0.565 },
                extreme: { legendary: 0.05, epic: 0.15, rare: 0.35, common: 0.45 }
            };

            let rates = { ...baseRates[simulationData.difficulty] };

            // Apply bonuses
            if (simulationData.bonuses.vip) {
                Object.keys(rates).forEach(key => {
                    if (key !== 'common') rates[key] *= 1.1;
                });
            }
            if (simulationData.bonuses.event) {
                Object.keys(rates).forEach(key => {
                    if (key !== 'common') rates[key] *= 1.2;
                });
            }
            if (simulationData.bonuses.lucky) {
                Object.keys(rates).forEach(key => {
                    if (key !== 'common') rates[key] *= 1.15;
                });
            }

            // Normalize
            const total = Object.values(rates).reduce((sum, rate) => sum + rate, 0);
            Object.keys(rates).forEach(key => {
                rates[key] /= total;
            });

            return rates;
        }

        function simulateDrop() {
            const rates = getDropRates();
            const random = Math.random();

            let cumulative = 0;
            for (const [rarity, rate] of Object.entries(rates)) {
                cumulative += rate;
                if (random <= cumulative) {
                    return rarity;
                }
            }

            return 'common';
        }

        function startSimulation() {
            showToast('Starting drop simulation...', 'info');

            // Reset results
            simulationData.results = {
                legendary: 0,
                epic: 0,
                rare: 0,
                common: 0,
                history: []
            };

            // Run simulation
            for (let i = 0; i < simulationData.count; i++) {
                const drop = simulateDrop();
                simulationData.results[drop]++;
                simulationData.results.history.push({
                    attempt: i + 1,
                    drop: drop,
                    item: generateItemName(drop)
                });
            }

            // Update display
            updateResults();
            updateChart();
            updateStatistics();
            updateRecommendations();

            showToast('Simulation complete!', 'success');
        }

        function generateItemName(rarity) {
            const items = {
                legendary: ['Flame Dragon Sword', 'Frost Armor', 'Shadow Cloak', 'Thunder Warhammer'],
                epic: ['Blazing Longsword', 'Ice Staff', 'Shadow Dagger', 'Thunder Battleaxe'],
                rare: ['Flame Shortsword', 'Frost Amulet', 'Shadow Belt', 'Thunder Bracers'],
                common: ['Iron Sword', 'Cloth Armor', 'Leather Boots', 'Wooden Shield']
            };

            const rarityItems = items[rarity];
            return rarityItems[Math.floor(Math.random() * rarityItems.length)];
        }

        function updateResults() {
            // Show results section
            document.getElementById('simulation-results').classList.remove('hidden');
            document.getElementById('no-simulation').classList.add('hidden');

            // Update counters
            document.getElementById('total-drops').textContent = simulationData.count;
            document.getElementById('legendary-count').textContent = simulationData.results.legendary;
            document.getElementById('epic-count').textContent = simulationData.results.epic;
            document.getElementById('rare-count').textContent = simulationData.results.rare;

            // Update drop history (show last 20 items)
            const historyContainer = document.getElementById('drop-history');
            const recentHistory = simulationData.results.history.slice(-20).reverse();

            const historyHtml = recentHistory.map(item => {
                const rarityColors = {
                    legendary: 'text-purple-600 bg-purple-50',
                    epic: 'text-blue-600 bg-blue-50',
                    rare: 'text-green-600 bg-green-50',
                    common: 'text-gray-600 bg-gray-50'
                };

                const rarityIcons = {
                    legendary: '‚≠ê',
                    epic: 'üíé',
                    rare: 'üî∑',
                    common: '‚ö™'
                };

                return `
                    <div class="flex justify-between items-center p-2 rounded ${rarityColors[item.drop]} mb-1">
                        <span class="text-sm">#${item.attempt}</span>
                        <span class="font-semibold">${rarityIcons[item.drop]} ${item.item}</span>
                    </div>
                `;
            }).join('');

            historyContainer.innerHTML = historyHtml;
        }

        function updateChart() {
            const ctx = document.getElementById('drop-chart').getContext('2d');

            if (dropChart) {
                dropChart.destroy();
            }

            dropChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Legendary', 'Epic', 'Rare', 'Common'],
                    datasets: [{
                        label: 'Drop Count',
                        data: [
                            simulationData.results.legendary,
                            simulationData.results.epic,
                            simulationData.results.rare,
                            simulationData.results.common
                        ],
                        backgroundColor: [
                            'rgba(147, 51, 234, 0.6)',
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(34, 197, 94, 0.6)',
                            'rgba(156, 163, 175, 0.6)'
                        ],
                        borderColor: [
                            'rgba(147, 51, 234, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(34, 197, 94, 1)',
                            'rgba(156, 163, 175, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateStatistics() {
            // Show statistics section
            document.getElementById('statistical-analysis').classList.remove('hidden');

            // Calculate actual rates
            const total = simulationData.count;
            const legendaryRate = (simulationData.results.legendary / total * 100).toFixed(1);
            const epicRate = (simulationData.results.epic / total * 100).toFixed(1);
            const rareRate = (simulationData.results.rare / total * 100).toFixed(1);

            // Update actual rates
            document.getElementById('actual-legendary').textContent = legendaryRate + '%';
            document.getElementById('actual-epic').textContent = epicRate + '%';
            document.getElementById('actual-rare').textContent = rareRate + '%';

            // Update progress bars
            document.getElementById('legendary-bar').style.width = legendaryRate + '%';
            document.getElementById('epic-bar').style.width = epicRate + '%';
            document.getElementById('rare-bar').style.width = rareRate + '%';

            // Calculate lucky/unlucky streaks
            const history = simulationData.results.history;
            let luckyStreak = 0;
            let unluckyStreak = 0;
            let currentLucky = 0;
            let currentUnlucky = 0;

            history.forEach(item => {
                if (item.drop === 'legendary') {
                    currentLucky++;
                    currentUnlucky = 0;
                    luckyStreak = Math.max(luckyStreak, currentLucky);
                } else {
                    currentUnlucky++;
                    currentLucky = 0;
                    unluckyStreak = Math.max(unluckyStreak, currentUnlucky);
                }
            });

            document.getElementById('lucky-streak').textContent = luckyStreak;
            document.getElementById('unlucky-streak').textContent = unluckyStreak;

            // Calculate cost analysis
            const costPerRun = 20; // Assume 20 stamina per run
            const totalCost = total * costPerRun;
            const costPerLegendary = simulationData.results.legendary > 0 ?
                Math.round(totalCost / simulationData.results.legendary) : 0;

            document.getElementById('cost-per-legendary').textContent = costPerLegendary;
            document.getElementById('total-cost').textContent = totalCost.toLocaleString();
        }

        function updateRecommendations() {
            // Show recommendations
            document.getElementById('recommendations').classList.remove('hidden');
            document.getElementById('no-recommendations').classList.add('hidden');

            // Calculate average attempts for legendary
            const avgAttempts = simulationData.results.legendary > 0 ?
                Math.round(simulationData.count / simulationData.results.legendary) : 0;

            if (avgAttempts > 0) {
                document.getElementById('avg-attempts').textContent = avgAttempts;
            } else {
                document.getElementById('avg-attempts').textContent = 'N/A (No drops)';
            }
        }

        function resetSimulation() {
            if (confirm('Are you sure you want to reset all simulation results?')) {
                // Hide results
                document.getElementById('simulation-results').classList.add('hidden');
                document.getElementById('no-simulation').classList.remove('hidden');
                document.getElementById('statistical-analysis').classList.add('hidden');
                document.getElementById('recommendations').classList.add('hidden');
                document.getElementById('no-recommendations').classList.remove('hidden');

                // Reset data
                simulationData.results = {
                    legendary: 0,
                    epic: 0,
                    rare: 0,
                    common: 0,
                    history: []
                };

                // Destroy chart
                if (dropChart) {
                    dropChart.destroy();
                    dropChart = null;
                }

                showToast('Simulator has been reset', 'success');
            }
        }
    </script>
</body>
</html>